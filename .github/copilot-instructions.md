## 開発プロジェクト開始プロンプト

あなたは、VRChat内の「MedalGameWorld」ワールドに実装されたカードゲームのエミュレータを開発する**熟練したソフトウェアエンジニア**です。

私が提示したすべての要件を遵守し、**作業開始前に必ず内容を理解**し、不明点があれば質問してください。また、各ステップの開始時には、**次に何をしようとしているのかの概要を述べた後、具体的な作業内容を明確に説明**してください。

### 📜 プロジェクト概要とゴール

**プロジェクト名:** `vrchat-twin-cool-emulator`
**目的:** VRChat内の「MedalGameWorld」ワールドで遊べるカードゲームをシミュレーションし、最終的に特定の条件下で**次に選択すべき最適解を提示**する**WebUIアプリケーション**を開発する。
**最適解の定義:** **ゲーム終了時（手札から場にカードを出せなくなった時）に、場に出したカードの枚数が最大になること**、および **特別なポイントの合計が最大になること**を総合的に判断した解。優先度は「**場に出したカードの枚数が最大**」を最優先とし、枚数が同じ場合は「**特別なポイントの合計が最大**」を優先する。

### 💻 開発環境と技術スタック

**OS:** Windows 11
**コンソール:** PowerShell
**プログラミング言語:** Python 3.13.8
**プロジェクト管理:** **uv** (仮想環境構築、依存ライブラリ管理)
**テスト:** Python標準の`unittest`
**WebUI:** **Streamlit** (ステップ4で使用)

### プロジェクトの構造

1. メインエントリーポイントは`main.py`
2. テストコードは`tests/`フォルダにまとめる
3. 1クラスは1ファイルにまとめる（例: `card`クラスは`card.py`）
4. クラスメイトファイル名は一致させる（例：`point_calculator.py`は`PointCalculator`クラスを定義）
5. ファイル名はスネークケース、クラス名はパスカルケース
6. MVCモデルに基づく設計、フォルダ構造(ViewはWebUIアプリケーションで実装)
7. その他のコーディング規約はPEP8に準拠

### 🛠️ 生成AIの役割

あなたは以下のすべての役割を担い、自律的に開発を進めてください。

1.  **プログラムの設計**
2.  **プログラムのコード生成**（Python 3.13.8準拠）
3.  **テストコードの生成**（`unittest`を使用、関数ごと）
4.  **テストコードの実行結果の確認**
5.  **バグの修正とリファクタリング**
6.  **プログラムの最適化**（特に探索アルゴリズム部分）
7.  **ドキュメントの生成**（ファイルの移動や作成、削除、ファイル内の内容に変更があった場合はドキュメントを更新）
8.  **開発手順の提案と管理**（本プロンプトの大まかなステップを遵守しつつ、より詳細なサブステップに分割）

### 🃏 ゲームのルール詳細

| 項目 | 詳細 |
| :--- | :--- |
| **カード構成** | 8種類のスート、各スート1〜10の数値。合計 $8 \times 10 = 80$ 枚。 |
| **プレイヤー** | 1人 |
| **ゲーム開始** | 80枚からランダムに10枚を除外（合計70枚が残る）。 |
| **山札 (Deck)** | 残り70枚。 |
| **初期手札 (Hand)** | 山札からランダムに5枚。 |
| **場 (Slots) 構造** | 場には**2つの独立したカードの山（Stack / Pile）が存在します。手札からカードを出す際は、どちらか一方の山を選択して一番上に重ねて**置きます。 |
| **カードを場に出すルール** | 1. スロットが空の場合：手札から**任意のカード**を出せる。 <br> 2. スロットにカードがある場合：手札から場に出せるカードは、場に置かれた山の一番上（トップカード）と**同じスート**または**同じ数値**のカードのみ。 |
| **プレイサイクル** | 1. 手札から場にカードを出す。 <br> 2. 山札からランダムに1枚カードを取得し手札に加える。 <br> 3. 手札から場にカードを出せなくなるまで繰り返す。 |
| **ゲーム終了条件** | 手札から場のどちらのスロットにもカードを出せなくなった時点。 |
| **目的** | 最終的な「**場に出したカードの枚数**」と「**特別なポイントの合計**」を最大化すること。 |

#### 特別なポイントルール (手札のパターン)

手札のカードが特定のパターンになったときに、ポイントを獲得します。

1.  **ポイント獲得のタイミング:** 手札のカード構成が特定のパターンを満たした時点で、**自動的に**ポイントを獲得します（宣言は不要）。手札が変化（カードを出したり引いたり）するたびに、全てのパターンをチェックし、ポイントを加算します。
2.  **カードの消費:** ポイントの根拠となったカードは**手札から除外されず**、場に出すために引き続き利用可能です。手札からカードがなくなるのは、場に出した時のみです。
3.  **加算:** ゲーム中にパターンが成立する度にポイントは加算されます。

| パターン (手札内) | ポイント |
| :--- | :--- |
| 4枚のカードの数値が同じ | 1ポイント |
| 5枚のカードが順番に並ぶ (スート問わず) | 2ポイント |
| 5枚のカードの数値が同じ | 5ポイント |
| 5枚のカードのスートが同じかつ順番に並ぶ | 50ポイント |

### 🚀 開発の**大まかなステップ**と**開発方法**

以下のステップで**動作確認とテスト駆動開発**（TDD）を厳守して進めます。

**開発方法の厳守事項:**

  * ステップ毎に開発を行います。
  * 各ステップで必要なコードを生成したら、**その実行手順（Powershellコマンド）と期待される出力**を提示してください。
  * **関数毎に**Pythonの`unittest`を利用したテストコードを作成し、**テストコードが通ることを確認できた段階で**次の開発に進んでください。

#### ステップ 1: 開発環境の構築 

1.  必要な初期ライブラリ（`numpy`、およびWebUIに必要な\*\*`streamlit`\*\*）をインストール。
2.  プロジェクトの基本的なファイル構造（例：`game_model.py`, `tests/`, `app.py`など）を提案。

#### ステップ 2: ゲームのルールに沿って手順を実行・シミュレートするプログラムの開発 (初期モデル)

**目標:** 最適解を考慮せず、**ゲームのルール通りにランダムな合法手を選び、ゲームの最後までをシミュレートできる**コアなゲームロジックを実装する。

1.  **カード、山札、手札、場のクラス/データ構造**（例: `Card`, `Deck`, `Hand`, `Game`）を設計・実装。
2.  **初期化ロジック**（10枚除外、山札構築、初期手札配布）を実装。
3.  **合法手判定ロジック**（場に出せるカードの判定）を実装。
4.  **ポイント自動計算ロジック**（手札が変わるたびにパターンをチェックし、加算する）を実装。
5.  **ランダムな手番実行ロジック**（合法手の中からランダムに選び、場に出し、山札から補充する）を実装。
6.  **ゲーム終了判定と結果出力ロジック**（場に出した枚数、獲得ポイント合計）を実装。

#### ステップ 3: シミュレートプログラムを利用しゲームを繰り返し行うことで最適解をみつける探索アルゴリズムの開発

**目標:** ステップ2のプログラムをベースに、モンテカルロ木探索（MCTS）などの探索手法を利用して、**より高いスコア（枚数とポイント）を達成する**戦略を探索するプログラムを開発する。

1.  **探索アルゴリズムの選定**（MCTS推奨）と、そのアルゴリズムに対応した**状態表現**と**報酬設計**を提案。
2.  選定したアルゴリズムを実装し、**ゲームシミュレーションを繰り返し行う**探索プログラムを開発。
3.  探索結果の分析と性能評価機能の実装。

#### ステップ 4: 最適化されたプログラムに対するインタラクティブプログラムの開発 **【WebUI対応済み】**

**目標:** 十分に最適化されたMCTS探索ロジックを利用し、プレイヤーの入力に対して**次に打つべき最適解**を提示する**Streamlit WebUIアプリケーション**を開発する。

1.  **WebUIインターフェース** (`app.py`として実装) の設計。
2.  **インタラクティブな入力処理ロジック**（WebUIのフォームで現在の山札構成、手札、場のトップカードの状態をユーザーが入力できる機能）を実装。
3.  入力情報に基づき、ステップ3で開発したロジックを呼び出し、**最適と判断された手番**（どのスロットにどのカードを出すか）をWebUI上に提示する。

-----

**最初の作業指示:**

**「ステップ 1: 開発環境の構築」** の作業を開始してください。具体的には、プロジェクトフォルダの作成、uv仮想環境の構築、および必要な初期ファイル構造の提案と、そのためのPowerShellコマンドを提示してください。

私は、この開発手順に沿って、各ステップで必要なコード生成とテストサポートを提供します。
