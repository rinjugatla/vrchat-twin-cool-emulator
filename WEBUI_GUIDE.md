# WebUIユーザーガイド

## 🚀 起動方法

```powershell
uv run streamlit run app.py
```

ブラウザで自動的に開かれます（通常は http://localhost:8501）

## 📖 使い方

### 1. ゲーム開始

アプリケーションを起動すると、自動的に新しいゲームが開始されます。

### 2. ゲーム状態の確認

**上部の統計情報**:
- **ターン数**: 現在のターン
- **場に出したカード**: これまでに出したカードの枚数
- **獲得ポイント**: 手札のパターンで獲得したポイント
- **手札枚数**: 現在の手札の枚数
- **山札残り**: 残りの山札枚数
- **総合スコア**: カード枚数×10 + ポイント×1

**場（2つのスロット）**:
- スロット1とスロット2のトップカードを表示
- 空のスロットには任意のカードを出せます
- カードがある場合は、同じスートまたは同じ数値のカードを出せます

**手札**:
- 現在の手札のカードを表示
- スートごとに色分けされています

**📊 山札状況**:
- 全80枚のカードを8スート×10数値の表形式で表示
- カードの状態を視覚的に確認できます
  - **🟥 赤色**: 推奨カード（次に使うべきカード）
  - **🟨 黄色**: 手札のカード
  - **薄い数値**: 使用済みカード（場に出したカード）
  - **空欄**: 山札に含まれないカード（初期の10枚除外）
  - **通常**: 山札に残っているカード

### 3. 最適解の分析

1. **「🔍 最適解を分析」ボタンをクリック**
   - MCTSアルゴリズムが最適な手を探索します
   - 探索回数はサイドバーで調整できます（50-2000回）

2. **推奨される手が表示されます**
   - 例: "✅ 推奨: A5 をスロット2に出す"

3. **「▶️ この手を実行」ボタンをクリック**
   - 推奨された手を実行します
   - ターンが進み、次の状態に移行します

### 4. サイドバー設定

**⚙️ 設定**:
- **MCTS探索回数**: 50-2000回
  - 少ない（50-200回）: 高速だが精度が低い
  - 中程度（300-500回）: バランスが良い（推奨）
  - 多い（1000-2000回）: 高精度だが時間がかかる

**📊 ゲーム情報**:
- シード値: ゲームの再現性のための乱数シード
- 現在のターン数

**🔄 新しいゲームを開始（ランダム）**:
- 現在のゲームをリセットして新しいゲームを開始（ランダムに10枚除外）

**🎯 除外カードを指定して開始**:
- 山札から除外する10枚のカードと初期手札5枚を手動で選択してゲームを開始
- 特定のシナリオをテストしたり、戦略を検証したりできます
- 使い方:
  1. ボタンをクリック
  2. **ステップ1**: 8スート×10数値の中から除外する10枚をチェックボックスで選択
  3. **次へ**ボタンをクリック（または「ランダムな手札で開始」を選択）
  4. **ステップ2**: 残り70枚の中から初期手札となる5枚を選択
  5. 「この設定でゲーム開始」をクリック

**📖 ゲームルール**:
- ゲームの詳細なルールを表示

### 5. 履歴の確認

ゲーム中の手の履歴を「📜 履歴」セクションで確認できます。
- 最新10手を表示
- ターン番号、カード、スロットを記録

## 🎯 プレイのヒント

### 最適な戦略

1. **カード枚数の最大化を優先**
   - ゲームの目標は、できるだけ多くのカードを場に出すこと
   - ポイントは次点の目標

2. **MCTS探索回数の調整**
   - 序盤: 300-500回で十分
   - 中盤以降: 500-1000回で精度向上
   - 重要な局面: 1000-2000回でより慎重に

3. **パターンを意識**
   - 手札が特定のパターンになるとポイント獲得
   - ただし、カード枚数の方が重要

### パフォーマンス

**MCTSアルゴリズムの成果**:
- ランダム戦略: 平均6.4枚
- **MCTS戦略: 平均17.8枚（+178%改善）**
- 最大50枚のカードをプレイ可能！

## 🔧 トラブルシューティング

### WebUIが起動しない

```powershell
# 依存関係を再インストール
uv sync

# Streamlitを直接実行
uv run streamlit run app.py --server.headless=true
```

### ポートが使用中

別のポートで起動：

```powershell
uv run streamlit run app.py --server.port=8502
```

### アプリが遅い

- MCTS探索回数を減らす（200-300回）
- ブラウザのキャッシュをクリア

## 📝 技術詳細

### MCTSアルゴリズム

1. **選択 (Selection)**: UCB1スコアで最も有望なノードを選択
2. **展開 (Expansion)**: 新しい子ノードを追加
3. **シミュレーション (Simulation)**: ランダムプレイアウトで結果を取得
4. **逆伝播 (Backpropagation)**: 結果をルートまで伝播

### 評価関数

```
スコア = (場に出したカード枚数 × 10) + (獲得ポイント × 1)
```

## 🎮 ゲームルール詳細

### カード構成
- 8種類のスート (A-H)
- 各スート1-10の数値
- 合計80枚 → ランダムに10枚除外 → 70枚使用

### プレイルール

**カードを出せる条件**:
- スロットが空: 任意のカード
- スロットにカードあり:
  - **同じスート** または **同じ数値**

**ゲームの流れ**:
1. 手札から場にカードを出す
2. 山札から1枚引く
3. 繰り返す
4. 出せるカードがなくなったら終了

### 特別なポイント

手札が以下のパターンになると自動でポイント獲得：

| パターン | ポイント | 例 |
|---------|---------|-----|
| 4枚同じ数値 | 1pt | A5, B5, C5, D5 |
| 5枚連番 | 2pt | A3, B4, C5, D6, E7 |
| 5枚同じ数値 | 5pt | A5, B5, C5, D5, E5 |
| 5枚同じスート連番 | 50pt | A3, A4, A5, A6, A7 |

### ゲーム目標

**優先度**:
1. **場に出したカード枚数を最大化**（最優先）
2. 特別なポイントを最大化（次点）

## 📊 統計情報

WebUI上部に表示される統計：
- **ターン数**: ゲーム開始からのターン数
- **場に出したカード**: 成功した手の回数
- **獲得ポイント**: パターンマッチで得たポイント合計
- **手札枚数**: 現在の手札のカード数
- **山札残り**: まだ引かれていないカードの枚数
- **総合スコア**: 最終評価スコア

## 🎉 楽しみ方

1. **挑戦**: できるだけ多くのカードを出すことを目指す
2. **実験**: 異なるMCTS探索回数で結果を比較
3. **学習**: MCTSの推奨を見て戦略を学ぶ
4. **比較**: 複数回プレイして最高記録を目指す

---

**開発**: twin-cool-emulator
**アルゴリズム**: Monte Carlo Tree Search (MCTS)
**フレームワーク**: Streamlit
